<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.5.2" />
<title>JAVA2核心技术第7版卷2高级特性</title>
<style type="text/css">
/* Debug borders */
p, li, dt, dd, div, pre, h1, h2, h3, h4, h5, h6 {
/*
  border: 1px solid red;
*/
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  font-family: sans-serif;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  font-family: serif;
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revnumber, span#revdate, span#revremark {
  font-family: sans-serif;
}

div#footer {
  font-family: sans-serif;
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #dddddd;
  color: #777777;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > div.content {
  white-space: pre;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-family: sans-serif;
  font-weight: bold;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}


@media print {
  div#footer-badges { display: none; }
}

div#toc {
  margin-bottom: 2.5em;
}

div#toctitle {
  color: #527bbd;
  font-family: sans-serif;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}
/* Workarounds for IE6's broken and incomplete CSS2. */

div.sidebar-content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}
div.sidebar-title, div.image-title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  margin-top: 0.0em;
  margin-bottom: 0.5em;
}

div.listingblock div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock-attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock-content {
  white-space: pre;
}
div.verseblock-attribution {
  padding-top: 0.75em;
  text-align: left;
}

div.exampleblock-content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

/* IE6 sets dynamically generated links as visited. */
div#toc a:visited { color: blue; }
</style>
<script type="text/javascript">
/*<![CDATA[*/
window.onload = function(){asciidoc.footnotes(); asciidoc.toc(2);}
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  var cont = document.getElementById("content");
  var noteholder = document.getElementById("footnotes");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      // Use [\s\S] in place of . so multi-line matches work.
      // Because JavaScript has no s (dotall) regex flag.
      note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      spans[i].innerHTML =
        "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
        "' title='View footnote' class='footnote'>" + n + "</a>]";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
}

}
/*]]>*/
</script>
</head>
<body>
<div id="header">
<h1>JAVA2核心技术第7版卷2高级特性</h1>
<span id="author">lds</span><br />
<span id="email"><tt>&lt;<a href="mailto:lds2012@gmail.com">lds2012@gmail.com</a>&gt;</tt></span><br />
<span id="revdate">2011-02-21</span>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="sidebarblock">
<div class="sidebar-content">
<div class="sidebar-title">LOG</div>
<div class="ulist"><ul>
<li>
<p>
2010-11-26 [START]
</p>
</li>
<li>
<p>
2010-11-26 p15
</p>
</li>
<li>
<p>
2010-11-27 p25 [PAUSE]
</p>
</li>
<li>
<p>
2010-12-02 p36
</p>
</li>
<li>
<p>
2010-12-02 p51
</p>
</li>
<li>
<p>
2010-12-03 p85
</p>
</li>
<li>
<p>
2010-12-04 p153
</p>
</li>
<li>
<p>
2010-12-07 p598 [PAUSE]
</p>
</li>
<li>
<p>
2011-01-23 p815 [EOF]
</p>
</li>
</ul></div>
</div></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="sidebar-title">TODO</div>
<div class="ulist"><ul>
<li>
<p>
1.5.4 LOCK p25 [DONE]
</p>
</li>
<li>
<p>
invokeAll &amp; ExecutorCompletionService p55
</p>
</li>
<li>
<p>
倒计时门栓, 交换器, 同步队列, 信号量 p57 ~ p62
</p>
</li>
<li>
<p>
线程与Swing p63 ~ p73
</p>
</li>
<li>
<p>
红-黑树数据结构
</p>
</li>
<li>
<p>
LinkedHashSet 高速缓存 p100
</p>
</li>
<li>
<p>
集合剩余部分 p100 ~ p124
</p>
</li>
<li>
<p>
可滚动的结果集&amp;可更新的结果集&amp;元数据&amp;行集  p188 ~ p209
</p>
</li>
<li>
<p>
高级连接管理 JNDI &amp; 连接池  p211
</p>
</li>
<li>
<p>
LDAP 轻量级目录访问协议(lightweight directory access protocol) p212 ~ p224
</p>
</li>
<li>
<p>
C5 分布式对象 p225 ~ p278
</p>
</li>
<li>
<p>
C6 高级Swing p279
</p>
</li>
<li>
<p>
C7 高级AWT p396
</p>
</li>
<li>
<p>
C8 JavaBean p534
</p>
</li>
<li>
<p>
XML DTD p772 ~ p790
</p>
</li>
<li>
<p>
元注释 p815
</p>
</li>
</ul></div>
</div></div>
</div>
</div>
<h2 id="_">1. 多线程/并发</h2>
<div class="sectionbody">
<div class="paragraph"><div class="title">进程和线程</div><p>每个进程有自己的变量的完备集,线程则共享相同的数据.
线程比进程更"轻量级",创建和销毁的开销更小.</p></div>
<div class="listingblock">
<div class="title">Runnable</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">// 定义一个类实现Runnable接口</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">MyRunnable</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> Runnable <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">// your code</span></span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">// 实例化该类</span></span>
<span style="color: #008080">Runnable</span> r <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">MyRunnable</span></span><span style="color: #990000">();</span>

<span style="font-style: italic"><span style="color: #9A1900">// 创建一个Thread对象, 传入Runnable对象</span></span>
<span style="color: #008080">Thread</span> t <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Thread</span></span><span style="color: #990000">(</span>r<span style="color: #990000">);</span>

<span style="font-style: italic"><span style="color: #9A1900">// 启动进程</span></span>
t<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">start</span></span><span style="color: #990000">();</span></tt></pre></div></div>
<div class="paragraph"><div class="title">中断线程</div><p>查看当前进程是否被中断
<tt>Thread.currentThread().isInterrupted()</tt></p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">try</span></span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span> <span style="font-style: italic"><span style="color: #9A1900">/* more work to do */</span></span> <span style="color: #990000">)</span>
        <span style="color: #FF0000">{</span>
            <span style="font-style: italic"><span style="color: #9A1900">// do more work</span></span>
            Thread<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">sleep</span></span><span style="color: #990000">(</span>delay<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span><span style="color: #990000">(</span><span style="color: #008080">InterruptedException</span> e<span style="color: #990000">)</span>
    <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">// thread was interrupted during sleep or wait</span></span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">finally</span></span>
    <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">// cleanup, if required</span></span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">sleep会抛出一个InterruptedException异常( <strong>实际测试未发现此现象</strong> ),并且抛出会也会清除中断状态.</td>
</tr></table>
</div>
<div class="paragraph"><p><tt>interrupt()</tt> 发送一个中断请求给一个线程,将线程的中断状态设为 <tt>True</tt> ,并抛出一个InterruptedException异常.
<tt>interrupted()</tt> 方法是一个静态方法,它检查当前线程是否已被中断,将线程的中断状态设为 <tt>false</tt> .
<tt>isInterrupted()</tt> 是一个实例方法,它只检查线程是否被中断,而不改变中断状态.</p></div>
<div class="ulist"><div class="title">线程状态</div><ul>
<li>
<p>
New, 新生状态, 调用 <tt>new Thread(r)</tt> 和 <tt>Thread.start</tt> 之间的状态.
</p>
</li>
<li>
<p>
Runnable, 可运行状态, 调用 <tt>start()</tt> 后, 可能是 <strong>正在运行</strong> ,也可能是 <strong>可运行的</strong> .
</p>
</li>
<li>
<p>
Blocked, 阻塞状态, 调用 <tt>sleep()</tt> , I/O上被阻塞, 被锁定 等情况
</p>
</li>
<li>
<p>
Dead, 死亡状态, <tt>run()</tt> 方法正常退出而自然死亡; 一个未捕获的异常提前终止了 <tt>run</tt> 方法而猝死.
</p>
</li>
</ul></div>
<div class="paragraph"><div class="title">阻塞状态</div><p>从阻塞状态回到可运行状态的途径:
    * 线程被置于睡眠状态,且指定睡眠时间已过.
    * 线程在等待I/O操作,且该操作已完成.
    * 线程在等待另一个线程所持有的锁,且另一个线程已经释放该锁的所有权(或等待超时.
    * 线程在等待某个触发条件,且另一个线程发出信号表明条件成立.(或等待超时)
    * 线程已被挂起( <tt>suspend()</tt> ), 且有人调用了 <tt>resume()</tt> 方法.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">一个被阻塞线程只能通过和先前阻塞它的相同过程重新进入可运行状态. 不能通过调用 <tt>resume</tt> 方法来解除非挂起原因导致阻塞线程的阻塞状态.</td>
</tr></table>
</div>
<div class="paragraph"><div class="title">死线程</div><p><tt>isAlive</tt> , 线程在可运行时或被阻塞时返回 <tt>true</tt> , new状态或死亡状态返回 <tt>false</tt> .</p></div>
<div class="paragraph"><div class="title">进程优先级</div><p>每个进程继承父进程的进程优先级.
调用 <tt>setPriority(i)</tt> 设置进程优先级. <tt>i</tt> 为 1 ~ 10 之间任意值.
    * <tt>Thread.MIN_PRIORITY = 1</tt>
    * <tt>Thread.NORM_PRIORITY = 5</tt>
    * <tt>Thread.MAX_PRIORITY = 10</tt></p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">如果高优先级的进程很不阻塞,那么低优先级的进程可能永远都不会被运行.完全被饿死.</td>
</tr></table>
</div>
<div class="paragraph"><div class="title">守护进程</div><p><tt>t.setDaemon(true)</tt></p></div>
<div class="paragraph"><p>守护进程唯一作用是为其他进程提供服务,如果只剩下守护进程那么虚拟机就自动退出.</p></div>
<div class="paragraph"><div class="title">进程组</div><p><tt>ThreadGroup g = new ThreadGroup("myGroupName");</tt>
`Thread t = new Thread(g, "mythreadName");</p></div>
<div class="paragraph"><p>嵌套
<tt>ThreadGroup(ThreadGroup parent, String name);</tt></p></div>
<div class="paragraph"><div class="title">未捕获异常处理器</div><p><tt>run</tt> 方法不能抛出任何被检查的异常, 但是不检查的异常可以导致线程终止(死亡).</p></div>
<div class="paragraph"><p>可为任何一个线程单独设置一个异常处理器
<tt>setDefaultUncaughtExceptionHandler</tt></p></div>
<div class="paragraph"><p><tt>Thread.UncaughtExceptionHandler</tt> 接口只有一个方法 <tt>void uncaughtExcetpion(THread t, Throwable e)</tt></p></div>
<h3 id="__2">1.1. 同步</h3><div style="clear:left"></div>
<div class="paragraph"><p>各个线程对相同对象进行共享访问.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>"如果你向一个变量写值,而这个变量接下来可能会被另一个线程所读取,或者你从一个变量读值,而它的值可能是前面由另一个线程写入的,此时你就必须使用同步."</tt></pre>
</div></div>
<div class="listingblock">
<div class="title">LOCK</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">Lock</span> myLock <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ReentrantLock</span></span><span style="color: #990000">();</span>

myLock<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">lock</span></span><span style="color: #990000">();</span>
<span style="font-weight: bold"><span style="color: #0000FF">try</span></span> <span style="color: #FF0000">{</span>
    <span style="font-style: italic"><span style="color: #9A1900">// some code</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">// 这里的结构保证在任何时候只有一个线程</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">// 能够进入临界区</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">// 被lock的对象, 不能被两个进程同时访问</span></span>
<span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">finally</span></span> <span style="color: #FF0000">{</span>
    myLock<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">unlock</span></span><span style="color: #990000">();</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">条件对象</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">Lock</span> myLock <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ReentrantLock</span></span><span style="color: #990000">();</span>
<span style="color: #008080">Condition</span> condition <span style="color: #990000">=</span> myLock<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">newCondition</span></span><span style="color: #990000">();</span>

myLock<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">lock</span></span><span style="color: #990000">();</span>
<span style="font-weight: bold"><span style="color: #0000FF">try</span></span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span>accounts<span style="color: #990000">[</span>from<span style="color: #990000">]</span> <span style="color: #990000">&lt;</span> amount<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-style: italic"><span style="color: #9A1900">// 调用await，该线程将进入阻塞状态，并放弃锁，其他进程可进入。</span></span>
        <span style="font-style: italic"><span style="color: #9A1900">// 该线程也将进入 *等待该条件集* 中，只有当 *另一个线程* 调用该条件</span></span>
        <span style="font-style: italic"><span style="color: #9A1900">// 的signalAll()方法，并且如果条件满足，才会解除阻塞</span></span>
        <span style="font-style: italic"><span style="color: #9A1900">//（并非马上可以对该对象进去访问，而是解除等待线程的阻塞状态，而是通过竞争去获得对对象的访问）。</span></span>
        condition<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">await</span></span><span style="color: #990000">();</span>
    <span style="color: #FF0000">}</span>
    <span style="font-style: italic"><span style="color: #9A1900">// 解除所有等待此条件的线程的阻塞状态</span></span>
    condition<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">signalAll</span></span><span style="color: #990000">();</span>

    <span style="font-style: italic"><span style="color: #9A1900">// 在该条件的等待集中随机选择一个线程，解除其阻塞状态</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">// condition.signal();</span></span>
<span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">finally</span></span> <span style="color: #FF0000">{</span>
    myLock<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">unlock</span></span><span style="color: #990000">();</span>
<span style="color: #FF0000">}</span>


<span style="font-style: italic"><span style="color: #9A1900">//在JDK5之前，使用synchronized来实现锁和条件</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">synchronized</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">transfer</span></span><span style="color: #990000">()</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span>accounts<span style="color: #990000">[</span>from<span style="color: #990000">]</span> <span style="color: #990000">&lt;</span> amount<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #000000">wait</span></span><span style="color: #990000">();</span>
    <span style="font-style: italic"><span style="color: #9A1900">// somecode</span></span>
    <span style="font-weight: bold"><span style="color: #000000">notifyAll</span></span><span style="color: #990000">();</span> <span style="font-style: italic"><span style="color: #9A1900">// 解除阻塞状态</span></span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="ulist"><div class="title">Lock&amp;Condition</div><ul>
<li>
<p>
锁用来保护代码片段，任何时刻只允许一个线程执行被保护的代码。
</p>
</li>
<li>
<p>
锁可以管理试图进入被保护代码段的线程
</p>
</li>
<li>
<p>
锁可以拥有一个或多个相关的条件对象（condition)
</p>
</li>
<li>
<p>
每个条件对象管理那些已进入被保护代码段但还不能运行（条件不成熟)的线程
</p>
</li>
</ul></div>
<div class="ulist"><div class="title">synchronized的缺点</div><ul>
<li>
<p>
不能中断一个正在试图获得锁的线程。Lock则有 <tt>lockInterruptibly()</tt>
</p>
</li>
<li>
<p>
试图获得锁时不能设置超时。
</p>
</li>
<li>
<p>
每个锁只能有一个条件。
</p>
</li>
<li>
<p>
虚拟机的加锁原句不能很好的映射到硬件可用的最有效的加锁机制上。
</p>
</li>
</ul></div>
<div class="ulist"><div class="title">lock和synchronized的选择</div><ul>
<li>
<p>
最好两者都不用，而是用 <tt>java.util.concurrent</tt> 中的另一种机制
</p>
</li>
<li>
<p>
如果 <tt>synchronized</tt> 可以满足需求，则用它，因为可以减少代码量。
</p>
</li>
<li>
<p>
只有在需要使用 <tt>Lock/Condition</tt> 结构的独有特性时才使用他们。
</p>
</li>
</ul></div>
<div class="paragraph"><div class="title">volatile关键词</div><p>线程能够自动发现 <tt>volatile</tt> 变量的最新值</p></div>
<div class="paragraph"><div class="title">死锁</div><p>每个线程都被阻塞. JAVA没有解决此问题的东西,只能靠自己设计时确保不会死锁.</p></div>
<div class="paragraph"><div class="title">公平锁</div><p><tt>Lock fairLock = new ReentrantLock(true);</tt>
它会优待那些等待了最长时间的线程. 但性能上牺牲较大.</p></div>
<div class="paragraph"><div class="title">tryLock</div><p><tt>boolean tryLock(long time, TimeUnit unit)</tt>
<tt>void lockInterruptibly()</tt>
<tt>awaitUninterryptibly()</tt></p></div>
<div class="paragraph"><div class="title">ReentrantReadWriteLock</div><p>分离read和write两种锁, 因为允许读取器线程共享访问是合适的.而写操作则必须互斥访问.</p></div>
<div class="paragraph"><div class="title">阻塞队列</div><p><tt>BlockingQueue</tt> 和 <tt>Queue</tt> 类似,只是提供了两个变种的 <tt>put</tt> , <tt>take</tt> 方法,用于操作时阻塞,直到条件成熟在执行.</p></div>
<div class="paragraph"><p><tt>put</tt> 在尾部添加一个元素, 如果列表为满,则阻塞,直到有空位.
<tt>take</tt> 移除并返回头部元素,如果列表为空,则阻塞,直到有元素可移除.</p></div>
<div class="paragraph"><p>阻塞队列是Java5线程新特征中的内容，Java定义了阻塞队列的接口java.util.concurrent.BlockingQueue，阻塞队列的概念是，一个指定长度的队列，如果队列满了，添加新元素的操作会被阻塞等待，直到有空位为止。同样，当队列为空时候，请求队列元素的操作同样会阻塞等待，直到有可用元素为止。
有了这样的功能，就为多线程的排队等候的模型实现开辟了便捷通道，非常有用。</p></div>
<div class="ulist"><div class="title"><tt>Java.util.concurrent</tt> 提供四种阻塞队列的变种:</div><ul>
<li>
<p>
LinkedBlockingQueue 没有上限, 由链表实现
</p>
</li>
<li>
<p>
ArrayBlockQueue 需要给定容量,并可选择是否需要公平性, 由循环数组实现
</p>
</li>
<li>
<p>
PriorityBlockQueue 带优先级的列表,不是先进先出原则,而是按优先顺序被移除.
</p>
</li>
<li>
<p>
DelayQueue 实现了delayed接口, 只有延迟已经过去的元素才能够从列表中移除
</p>
</li>
</ul></div>
<div class="paragraph"><div class="title">线程安全的集合</div><p>BlockQueue就是一个线程安全的集合.</p></div>
<div class="paragraph"><p><tt>ConcurrentHashMap</tt> 和 <tt>ConcurrentLinkedQueue</tt></p></div>
<div class="paragraph"><p><tt>CopyOnWriteArrayList</tt> 适合使用在读操作远远大于写操作的场景里，比如缓存。</p></div>
<div class="paragraph"><div class="title">同步包装器</div><p><tt>List synchArrayList = Collections.synchronizedList(new ArrayList());</tt></p></div>
<div class="paragraph"><div class="title">Callable &amp; Future</div><p><tt>Runnable</tt> 封装一个异步运行的任务;一个没有任何参数和返回值的异步方法.
<tt>Callable</tt> 与 <tt>Runnable</tt> 类似, 但有返回值.</p></div>
<div class="paragraph"><p><tt>Future</tt> 保存异步计算的结果. <tt>Future</tt> 对象的所有者在结果计算好之后就可以得到它.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">MyComputation</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> Callable<span style="color: #990000">&lt;</span>Integer<span style="color: #990000">&gt;</span>
<span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> count<span style="color: #990000">;</span>
    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #000000">MyComputation</span></span><span style="color: #990000">(</span><span style="color: #008080">String</span> keyword<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #FF0000">}</span>
    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #008080">Integer</span> <span style="font-weight: bold"><span style="color: #000000">call</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> count<span style="color: #990000">;</span>  <span style="font-style: italic"><span style="color: #9A1900">// must return Integer</span></span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="color: #008080">Callable&lt;Integer&gt;</span> myComputation <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">MyComputation</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"args"</span><span style="color: #990000">);</span>
<span style="font-style: italic"><span style="color: #9A1900">// 将Callable转换成Future和Runable</span></span>
<span style="color: #008080">FuturnTast&lt;integer&gt;</span> task <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> FuturnTast<span style="color: #990000">&lt;</span>Integer<span style="color: #990000">&gt;(</span>myComputation<span style="color: #990000">);</span>

<span style="color: #008080">Thread</span> t <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Thread</span></span><span style="color: #990000">(</span>task<span style="color: #990000">);</span> <span style="font-style: italic"><span style="color: #9A1900">// it's a Runnable</span></span>
t<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">start</span></span><span style="color: #990000">();</span>
<span style="font-style: italic"><span style="color: #9A1900">// ...</span></span>

<span style="font-style: italic"><span style="color: #9A1900">// 调用get()时会发生阻塞,直到可获得结果为止</span></span>
<span style="color: #008080">Integer</span> result <span style="color: #990000">=</span> task<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">();</span> <span style="font-style: italic"><span style="color: #9A1900">// it's a Future</span></span></tt></pre></div></div>
<div class="paragraph"><div class="title">执行器</div><p>如果你的程序创建了大量生存期很短的线程,那就应该使用线程池.</p></div>
<div class="ulist"><div class="title">线程池</div><ul>
<li>
<p>
newCachedThreadPool(), 带缓存的线程池,线程空闲60秒后关闭.
</p>
</li>
<li>
<p>
newFixedThreadPool(int threads), 指定数量的线程池.
</p>
</li>
<li>
<p>
newSingleThreadExecutor(), 但个线程的线程池,一个一个的执行.
</p>
</li>
</ul></div>
<div class="paragraph"><p><tt>Future&lt;T&gt; submit(Callable&lt;T&gt; task)</tt>
<tt>Future&lt;T&gt; submit(Runnable task, T result)</tt>
<tt>Future&lt;T&gt; submit(Runnable task)</tt></p></div>
<div class="ulist"><div class="title">预订执行线程池</div><ul>
<li>
<p>
newScheduledThreadPool(int threads)
</p>
</li>
<li>
<p>
newSingleThreadScheduledExecutor()
</p>
</li>
</ul></div>
<div class="paragraph"><p><tt>ScheduledFuture&lt;V&gt; schedule(Callable&lt;V&gt; task, long time, TimeUnit unit)</tt>
<tt>ScheduledFuture&lt;?&gt; schedule(Runnbale task, long time, TimeUnit unit)</tt></p></div>
<div class="paragraph"><div class="title">同步器</div><p><tt>CyclicBarrier</tt> 类实现了一个成为 障栅 barrier 的集合点, 当所有线程都达到某个集合点,才可以继续运行.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">CyclicBarrier</span> barrier <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">CyclicBarrier</span></span><span style="color: #990000">(</span>nthreas<span style="color: #990000">);</span>
<span style="font-style: italic"><span style="color: #9A1900">// 也可执行所以线程到达集合点后的一个行为动作</span></span>
<span style="font-style: italic"><span style="color: #9A1900">// CyclicBarrier(int threas, Runnable action);</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">run</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    <span style="font-style: italic"><span style="color: #9A1900">// do something</span></span>

    <span style="font-style: italic"><span style="color: #9A1900">// 等待其他线程达到集合点</span></span>
    barrier<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">await</span></span><span style="color: #990000">();</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">线程与Swing</div>Swing 不是线程安全的!</td>
</tr></table>
</div>
</div>
<h2 id="__3">2. 集合</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">迭代器</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">interface</span></span> <span style="color: #008080">Iterator</span><span style="color: #990000">&lt;</span>E<span style="color: #990000">&gt;</span>
<span style="color: #FF0000">{</span>
    <span style="color: #008080">E</span> <span style="font-weight: bold"><span style="color: #000000">next</span></span><span style="color: #990000">();</span>
    <span style="color: #009900">boolean</span> <span style="font-weight: bold"><span style="color: #000000">hasNext</span></span><span style="color: #990000">();</span>
    <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">remove</span></span><span style="color: #990000">();</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Iterator的remove方法将会移除上次调用next方法时返回的元素. (也就是说 <strong>每次</strong> <tt>remove</tt> 之前都必须调用一次 <tt>next</tt> 方法)</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Java迭代器指向的是两个元素之间的位置.</td>
</tr></table>
</div>
<div class="ulist"><div class="title">基本集合类型</div><ul>
<li>
<p>
ArrayList, get(), set().
</p>
</li>
<li>
<p>
LinkedList, 中间插入.
</p>
</li>
<li>
<p>
HashSet, 散列集, 无序集合
</p>
</li>
<li>
<p>
TreeSet, 树集, 有序集合
</p>
</li>
<li>
<p>
EnumSet
</p>
</li>
<li>
<p>
LinkedHashSet
</p>
</li>
<li>
<p>
PriorityQueue, 优先级队列, 使用堆实现(可自我调整的二叉树),并不对所有元素进行排序.
</p>
</li>
<li>
<p>
HashMap
</p>
</li>
<li>
<p>
TreeMap
</p>
</li>
<li>
<p>
EnumMap
</p>
</li>
<li>
<p>
LinkedHashMap
</p>
</li>
<li>
<p>
WeakHashMap, 弱散列映射表
</p>
</li>
<li>
<p>
IdentityHashMap
</p>
</li>
</ul></div>
<div class="paragraph"><div class="title">链表</div><p>在JAVA中,所有链表都是双链表.</p></div>
<div class="paragraph"><div class="title">listIterator</div><p>接口提供add方法和previous方法.
add方法将新元素添加到迭代器位置的前面.
set方法将替代上一次next或previous返回的值</p></div>
<div class="paragraph"><div class="title">散列表</div><p>散列表是个链表的数组,每个列表成为一个散列表元.若要查找表中的某个对象的位置,只要计算出它的散列码(hashCode),再将它除以散列表元的总数得到的 <strong>余数</strong> ,就是包含该元素的散列表元的索引.
例如一个对象的散列码为 <tt>76268</tt> , 散列表元共有 <tt>128</tt> 个, 那么它的位置是 <tt>76268 % 128 = 108</tt></p></div>
<div class="paragraph"><div class="title">映射表</div><p>键/值对, HashMap, TreeMap
HashMap, 对键进行散列. 无序.
TreeMap, 使用键的全局顺序进行排序,并将其组织成搜索树. 有序.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">散列函数或比较函数只能作用于键.值不能进行散列或比较.
NOTE: 键必须是唯一的.</td>
</tr></table>
</div>
</div>
<h2 id="__4">3. 网络</h2>
<div class="sectionbody">
<div class="paragraph"><div class="title">Socket</div><p><tt>Socket(String host, int post)</tt>
<tt>InputStream getInputStream()</tt>
<tt>OutputStream getOutputStream()</tt></p></div>
<div class="paragraph"><div class="title">ServerSocket</div><p><tt>ServerSocket(int post)</tt>
<tt>Sockted accpet()</tt>
<tt>close()</tt></p></div>
<div class="listingblock">
<div class="title">多客户端</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">ServerSocket</span> s <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ServerSocket</span></span><span style="color: #990000">(</span><span style="color: #993399">8189</span><span style="color: #990000">);</span>

<span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">)</span>
<span style="color: #FF0000">{</span>
    <span style="color: #008080">Socket</span> incoming <span style="color: #990000">=</span> s<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">accept</span></span><span style="color: #990000">();</span>
    System<span style="color: #990000">.</span>out<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Spawning "</span> <span style="color: #990000">+</span> i<span style="color: #990000">);</span>
    <span style="color: #008080">Runnable</span> r <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ThreadedEchoHandler</span></span><span style="color: #990000">(</span>incoming<span style="color: #990000">,</span> i<span style="color: #990000">);</span>
    <span style="color: #008080">Thread</span> t <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Thread</span></span><span style="color: #990000">(</span>r<span style="color: #990000">);</span>
    t<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">start</span></span><span style="color: #990000">();</span>
    i<span style="color: #990000">++;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><div class="title">发EMAIL</div><p><tt>SMTP port = 25</tt></p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">大部分SMTP服务器都不检查信息的真实性,你可以随便填写任何你喜欢使用的 <strong>发件人</strong> 名字.</td>
</tr></table>
</div>
<div class="paragraph"><div class="title">URL</div><p>可以打开一个流.</p></div>
<div class="paragraph"><div class="title">URI</div><p>只负责解析URI, 也可进行URL的相对化和绝对化转换
    * getScheme
    * getSchemeSpecificPart
    * getHost
    * getPost
    * getPath
    * getQuery
    * &#8230;</p></div>
<div class="paragraph"><div class="title">URLConnection</div><p><tt>setRequestProperty()</tt>
<tt>connect()</tt>
<tt>getHeaderFields()</tt></p></div>
<div class="listingblock">
<div class="title">POST数据</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">try</span></span> <span style="color: #FF0000">{</span>
    <span style="font-style: italic"><span style="color: #9A1900">// init URL</span></span>
    <span style="color: #008080">URL</span> url <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">URL</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"http://localhost/client.php"</span><span style="color: #990000">);</span>
    <span style="color: #008080">URLConnection</span> urlc <span style="color: #990000">=</span> url<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">openConnection</span></span><span style="color: #990000">();</span>
    urlc<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setDoOutput</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">);</span>

    <span style="font-style: italic"><span style="color: #9A1900">// POST data { name:lds, password:123 }</span></span>
    <span style="color: #008080">PrintWriter</span> out <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">PrintWriter</span></span><span style="color: #990000">(</span>urlc<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getOutputStream</span></span><span style="color: #990000">());</span>
    out<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"name="</span> <span style="color: #990000">+</span> URLEncoder<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">encode</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"lds"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"UTF-8"</span><span style="color: #990000">)</span> <span style="color: #990000">+</span> <span style="color: #FF0000">"&amp;"</span> <span style="color: #990000">);</span>
    out<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"password="</span> <span style="color: #990000">+</span> URLEncoder<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">encode</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"123"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"UTF-8"</span><span style="color: #990000">));</span>
    out<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">();</span>

    <span style="font-style: italic"><span style="color: #9A1900">// connect to the server</span></span>
    urlc<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">();</span>

    <span style="font-style: italic"><span style="color: #9A1900">// print HeaderFields</span></span>
    <span style="color: #008080">Map&lt;String, List&lt;String&gt;&gt;</span> map <span style="color: #990000">=</span> urlc<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getHeaderFields</span></span><span style="color: #990000">();</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span>Map<span style="color: #990000">.</span><span style="color: #008080">Entry&lt;String, List&lt;String&gt;&gt;</span> entry <span style="color: #990000">:</span> map<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">entrySet</span></span><span style="color: #990000">()</span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        System<span style="color: #990000">.</span>out<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span>entry<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getKey</span></span><span style="color: #990000">()</span> <span style="color: #990000">+</span> <span style="color: #FF0000">" : "</span> <span style="color: #990000">+</span> entry<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getValue</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">toString</span></span><span style="color: #990000">());</span>
    <span style="color: #FF0000">}</span>

    <span style="font-style: italic"><span style="color: #9A1900">// print response(inputStream)</span></span>
    <span style="color: #008080">Scanner</span> scanner <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Scanner</span></span><span style="color: #990000">(</span>urlc<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getInputStream</span></span><span style="color: #990000">());</span>
    <span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span>scanner<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">hasNext</span></span><span style="color: #990000">())</span> <span style="color: #FF0000">{</span>
        System<span style="color: #990000">.</span>out<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span>scanner<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">nextLine</span></span><span style="color: #990000">());</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span><span style="color: #008080">Exception</span> e<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    e<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">printStackTrace</span></span><span style="color: #990000">();</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p><tt>HttpUrlConnection</tt> 的方法 <tt>getErrorStream()</tt> 可以得到 <tt>404</tt> 之类的HTTP错误代号和信息.</p></div>
<div class="listingblock">
<div class="title">高级套接字编程</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">// 建立无连接的套接字</span></span>
<span style="color: #008080">Socket</span> s <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Socket</span></span><span style="color: #990000">();</span>
<span style="font-style: italic"><span style="color: #9A1900">// 设置超时</span></span>
s<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">InetSocketAddress</span></span><span style="color: #990000">(</span>host<span style="color: #990000">,</span> post<span style="color: #990000">),</span> timeout<span style="color: #990000">);</span>


<span style="font-style: italic"><span style="color: #9A1900">// 可interrupt的channel;</span></span>
<span style="color: #008080">SocketChannel</span> channel <span style="color: #990000">=</span> SocketChannel<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">open</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">InetSocketAddress</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"localhost"</span><span style="color: #990000">,</span> <span style="color: #993399">8189</span><span style="color: #990000">));</span></tt></pre></div></div>
<div class="paragraph"><div class="title">半关闭</div><p>通过关闭一个套接字的输出流来表示发送给服务器的数据已经结束,但必须保留输入流用以读取服务器返回的响应信息.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">Socket</span> socket <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Socket</span></span><span style="color: #990000">(</span>host<span style="color: #990000">,</span> post<span style="color: #990000">);</span>
<span style="color: #008080">Scanner</span> in <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Scanner</span></span><span style="color: #990000">(</span>socket<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getInputStream</span></span><span style="color: #990000">());</span>
<span style="color: #008080">PrintWriter</span> writer <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">PrintWriter</span></span><span style="color: #990000">(</span>socket<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getOutputStream</span></span><span style="color: #990000">());</span>
<span style="font-style: italic"><span style="color: #9A1900">// send request data</span></span>
writer<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"data"</span><span style="color: #990000">);</span>
writer<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">flush</span></span><span style="color: #990000">();</span>
socket<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">shutdownOutput</span></span><span style="color: #990000">();</span>
<span style="font-style: italic"><span style="color: #9A1900">// now socket is half closed</span></span>
<span style="font-style: italic"><span style="color: #9A1900">// read response data</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span> <span style="color: #990000">(</span>in<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">hasNextLine</span></span><span style="color: #990000">())</span> <span style="color: #990000">!=</span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span> <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-style: italic"><span style="color: #9A1900">//...</span></span>
<span style="color: #FF0000">}</span>
socket<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">();</span></tt></pre></div></div>
</div>
<h2 id="__5">4. 数据库编程</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">加载数据库驱动</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>System<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setProperty</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"jdbc.drivers"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"org.postgresql.Driver"</span><span style="color: #990000">);</span>
<span style="font-style: italic"><span style="color: #9A1900">// 或者</span></span>
Class<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">forName</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"org.postgresql.Driver"</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">// 读取属性文件</span></span>
<span style="font-style: italic"><span style="color: #9A1900">// jdbc.url=jdbc:postgresql:COREJAVA</span></span>

<span style="color: #008080">Properties</span> props <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Properties</span></span><span style="color: #990000">();</span>
<span style="color: #008080">FileInputStream</span> in <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">FileInputStream</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"database.properties"</span><span style="color: #990000">);</span>
props<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">load</span></span><span style="color: #990000">(</span>in<span style="color: #990000">);</span>
in<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">();</span>
<span style="color: #008080">String</span> url <span style="color: #990000">=</span> props<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getProperty</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"jdbc.url"</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="ulist"><div class="title">Statement</div><ul>
<li>
<p>
<tt>executeUpdate</tt> 可以执行 <tt>INSERT</tt> <tt>UPDATE</tt> <tt>DELETE</tt> <tt>CREATE TABLE</tt> <tt>DROP TABLE</tt>
</p>
</li>
<li>
<p>
<tt>executeQuery</tt> 可以执行 <tt>SELECT</tt>
</p>
</li>
<li>
<p>
<tt>execute</tt> 可以执行所有SQL语句
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">ResultSet</span> rs <span style="color: #990000">=</span> stat<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">executeQuery</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"SELECT * FROM Book"</span><span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">while</span></span> <span style="color: #990000">(</span>rs<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">next</span></span><span style="color: #990000">())</span> <span style="color: #FF0000">{</span>
    <span style="color: #008080">String</span> name <span style="color: #990000">=</span> rs<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getString</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"name"</span><span style="color: #990000">);</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><div class="title">DriverManager</div><p><tt>static Connection getConnect(String url, String user, String password)</tt></p></div>
<div class="paragraph"><div class="title">Connection</div><p><tt>Statement createStatement()</tt>
<tt>void close()</tt></p></div>
<div class="paragraph"><div class="title">Statement</div><p><tt>ResultSet executeQuery(String sqlQuery)</tt>
<tt>int executeUpdate(STring sqlStatement)</tt>
<tt>boolean execute(String sqlStatement)</tt>
<tt>int getUpdateCount()</tt>
<tt>ResultSet getResultSet()</tt>
<tt>void close()</tt></p></div>
<div class="paragraph"><div class="title">SQLException</div><p><tt>String getSQLState()</tt>
<tt>int getErrorCode()</tt>
<tt>SQLException getNextException()</tt></p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">当时用完ResultSet, Statement, Connection对象后, 应立即调用close方法. (直接关闭Connection可关闭该连接上的所有Statement和ResultSet.)</td>
</tr></table>
</div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #008080">PreparedStatement</span> prep <span style="color: #990000">=</span> conn
        <span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">prepareStatement</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"insert into people values (?, ?);"</span><span style="color: #990000">);</span>

prep<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setString</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Gandhi"</span><span style="color: #990000">);</span>
prep<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setString</span></span><span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> <span style="color: #FF0000">"politics"</span><span style="color: #990000">);</span>
prep<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">executeQuery</span></span><span style="color: #990000">();</span>

<span style="font-style: italic"><span style="color: #9A1900">// 或者批处理</span></span>
prep<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setString</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Gandhi"</span><span style="color: #990000">);</span>
prep<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setString</span></span><span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> <span style="color: #FF0000">"politics"</span><span style="color: #990000">);</span>
prep<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addBatch</span></span><span style="color: #990000">();</span>
prep<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setString</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Turing"</span><span style="color: #990000">);</span>
prep<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setString</span></span><span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> <span style="color: #FF0000">"computers"</span><span style="color: #990000">);</span>
prep<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addBatch</span></span><span style="color: #990000">();</span>
prep<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setString</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #FF0000">"Wittgenstein"</span><span style="color: #990000">);</span>
prep<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setString</span></span><span style="color: #990000">(</span><span style="color: #993399">2</span><span style="color: #990000">,</span> <span style="color: #FF0000">"smartypants"</span><span style="color: #990000">);</span>
prep<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addBatch</span></span><span style="color: #990000">();</span>

prep<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">executeBatch</span></span><span style="color: #990000">();</span></tt></pre></div></div>
<div class="paragraph"><div class="title">事务</div><p><tt>conn.getAutoCommit(false)</tt>
<tt>conn.commit()</tt>
<tt>conn.rollback()</tt></p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">// 开启事务</span></span>
conn<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getAutoCommit</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">);</span>

<span style="color: #008080">Statement</span> stat <span style="color: #990000">=</span> conn<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">createStatement</span></span><span style="color: #990000">();</span>
stat<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">excuteUpdate</span></span><span style="color: #990000">(</span>command1<span style="color: #990000">);</span>

<span style="font-style: italic"><span style="color: #9A1900">// 设置保存点</span></span>
<span style="color: #008080">Savepoint</span> svpt <span style="color: #990000">=</span> conn<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setSavepoint</span></span><span style="color: #990000">();</span>

<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-style: italic"><span style="color: #9A1900">/*...*/</span></span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-style: italic"><span style="color: #9A1900">// 回滚到指定的保存点</span></span>
    conn<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">rollback</span></span><span style="color: #990000">(</span>svpt<span style="color: #990000">);</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">// 释放保存点</span></span>
conn<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">releaseSavepoint</span></span><span style="color: #990000">(</span>svpt<span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><div class="title">批量操作</div><p><tt>addBatch()</tt>
<tt>executeBatch()</tt></p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">不能在批量操作中加入 <tt>SELECT</tt> 语句.</td>
</tr></table>
</div>
</div>
<h2 id="_xml">5. XML</h2>
<div class="sectionbody">
<div class="ulist"><div class="title">解析器</div><ul>
<li>
<p>
DOM, w3c标准
</p>
</li>
<li>
<p>
SAX,
</p>
</li>
</ul></div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2011-01-23 15:06:00 CST
</div>
</div>
</body>
</html>
