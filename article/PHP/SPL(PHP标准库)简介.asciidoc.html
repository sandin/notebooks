<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.5.2" />
<title>SPL(PHP标准库) 简介</title>
<style type="text/css">
/* Debug borders */
p, li, dt, dd, div, pre, h1, h2, h3, h4, h5, h6 {
/*
  border: 1px solid red;
*/
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  font-family: sans-serif;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  font-family: serif;
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revnumber, span#revdate, span#revremark {
  font-family: sans-serif;
}

div#footer {
  font-family: sans-serif;
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #dddddd;
  color: #777777;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > div.content {
  white-space: pre;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-family: sans-serif;
  font-weight: bold;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}


@media print {
  div#footer-badges { display: none; }
}

div#toc {
  margin-bottom: 2.5em;
}

div#toctitle {
  color: #527bbd;
  font-family: sans-serif;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}
/* Workarounds for IE6's broken and incomplete CSS2. */

div.sidebar-content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}
div.sidebar-title, div.image-title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  margin-top: 0.0em;
  margin-bottom: 0.5em;
}

div.listingblock div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock-attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock-content {
  white-space: pre;
}
div.verseblock-attribution {
  padding-top: 0.75em;
  text-align: left;
}

div.exampleblock-content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

/* IE6 sets dynamically generated links as visited. */
div#toc a:visited { color: blue; }
</style>
<script type="text/javascript">
/*<![CDATA[*/
window.onload = function(){asciidoc.footnotes();}
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  var cont = document.getElementById("content");
  var noteholder = document.getElementById("footnotes");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      // Use [\s\S] in place of . so multi-line matches work.
      // Because JavaScript has no s (dotall) regex flag.
      note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      spans[i].innerHTML =
        "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
        "' title='View footnote' class='footnote'>" + n + "</a>]";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
}

}
/*]]>*/
</script>
</head>
<body>
<div id="header">
<h1>SPL(PHP标准库) 简介</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>以下部分为我在读 &lt;PHP高级程序设计模式框架与测试&gt; 记的读书笔记中的一个章节, 因为关于发现网上关于 <tt>SPL</tt> 的介绍并不是很多, 所以节选上来供大家参考, 大部分为摘抄加一些个人注解.</p></div>
<div class="sidebarblock">
<div class="sidebar-content">
<div class="paragraph"><p>第三部分 SPL（标准PHP库）</p></div>
</div></div>
</div>
</div>
<h2 id="_9_spl_114">1. 第9章 SPL简介 114</h2>
<div class="sectionbody">
<h3 id="_9_1_spl_114">1.1. 9.1 SPL基础 114</h3><div style="clear:left"></div>
<h3 id="_9_2_115">1.2. 9.2 迭代器 115</h3><div style="clear:left"></div>
<h4 id="_9_2_1_iterator_115">1.2.1. 9.2.1 Iterator接口 115</h4>
<div class="paragraph"><p>模式原型</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;?php</span>

interface Iterator <span style="color: #FF0000">{</span>
    public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">current</span></span><span style="color: #990000">();</span>   <span style="font-style: italic"><span style="color: #9A1900">//value</span></span>
    public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">key</span></span><span style="color: #990000">();</span>        <span style="font-style: italic"><span style="color: #9A1900">//key</span></span>
    public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">next</span></span><span style="color: #990000">();</span>
    public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">rewind</span></span><span style="color: #990000">();</span>    <span style="font-style: italic"><span style="color: #9A1900">//指针移到开始位置</span></span>
    public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">valid</span></span><span style="color: #990000">();</span>       <span style="font-style: italic"><span style="color: #9A1900">//当前元素是否存在，必须在使用了next(),rewind()后才能调用</span></span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<h4 id="_9_2_2_116">1.2.2. 9.2.2 迭代器辅助函数 116</h4>
<div class="paragraph"><p><tt>iterator_to_array($iterator)</tt>
将迭代器转换为一个数组</p></div>
<div class="paragraph"><p>`iterator_count($iterator)` </p></div>
<div class="paragraph"><p><tt>iterator_apply(iterator, callback, [user date])</tt>
类似于array_walk</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;?php</span>

<span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">print_entry</span></span><span style="color: #990000">(</span><span style="color: #009900">$iterator</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span> <span style="color: #009900">$iterator</span><span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">current</span></span><span style="color: #990000">()</span> <span style="color: #990000">);</span>
  <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">;</span>  <span style="font-style: italic"><span style="color: #9A1900">//回调函数返回true就继续循环，否则退出循环。</span></span>
<span style="color: #FF0000">}</span>

<span style="color: #009900">$array</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">array</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span><span style="color: #993399">2</span><span style="color: #990000">,</span><span style="color: #993399">3</span><span style="color: #990000">);</span>
<span style="color: #009900">$iterator</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ArrayIterator</span></span><span style="color: #990000">(</span><span style="color: #009900">$array</span><span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #000000">iterator_apply</span></span><span style="color: #990000">(</span><span style="color: #009900">$iterator</span><span style="color: #990000">,</span> <span style="color: #FF0000">'print_entry'</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">array</span></span><span style="color: #990000">(</span><span style="color: #009900">$iterator</span><span style="color: #990000">));</span></tt></pre></div></div>
<h3 id="_9_3_117">1.3. 9.3 数组重载 117</h3><div style="clear:left"></div>
<div class="paragraph"><p>数组重载是将对象作为数组使用的一个过程。</p></div>
<h4 id="_9_3_1_arrayaccess_117">1.3.1. 9.3.1 ArrayAccess接口 117</h4>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;?php</span>

interface ArrayAccess <span style="color: #FF0000">{</span>
    public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">offsetExists</span></span><span style="color: #990000">(</span><span style="color: #009900">$offset</span><span style="color: #990000">);</span>  <span style="font-style: italic"><span style="color: #9A1900">//确定给的偏移量是否存在于数组中</span></span>
    public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">offsetSet</span></span><span style="color: #990000">(</span><span style="color: #009900">$offset</span><span style="color: #990000">);</span>        <span style="font-style: italic"><span style="color: #9A1900">//设置/替换偏移量位置上的数据</span></span>
    public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">offsetGet</span></span><span style="color: #990000">(</span><span style="color: #009900">$offset</span><span style="color: #990000">);</span>      <span style="font-style: italic"><span style="color: #9A1900">//返回偏移量位置上的数据</span></span>
    public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">offsetUnset</span></span><span style="color: #990000">(</span><span style="color: #009900">$offset</span><span style="color: #990000">);</span>   <span style="font-style: italic"><span style="color: #9A1900">//unset</span></span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<h4 id="_9_3_2_117">1.3.2. 9.3.2 计数和数组访问 117</h4>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;?php</span>

interfacec Countable <span style="color: #FF0000">{</span>
    public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">count</span></span><span style="color: #990000">();</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<h3 id="_9_4_118">1.4. 9.4 观察者模式 118</h3><div style="clear:left"></div>
<div class="paragraph"><p>被观察 subject
观察者 observer</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;?php</span>

interface SplSubject <span style="color: #FF0000">{</span>
    public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">attach</span></span><span style="color: #990000">(</span>SplObserver <span style="color: #009900">$observer</span><span style="color: #990000">);</span>
    public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">detach</span></span><span style="color: #990000">(</span>SplObserver <span style="color: #009900">$observer</span><span style="color: #990000">);</span>
    public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">notify</span></span><span style="color: #990000">();</span>
<span style="color: #FF0000">}</span>

interface SplObserver <span style="color: #FF0000">{</span>
    public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">update</span></span><span style="color: #990000">(</span>SplSubject <span style="color: #009900">$subject</span><span style="color: #990000">);</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>流程：
1. subject给observer注册（保存observer对象在列表中）。
2. 当subject发生变化时调用自己的notify();
3. notify()调用保存在列表中的每个observer对象的observer&#8594;update()；</p></div>
<h3 id="_9_5_121">1.5. 9.5 序列化 121</h3><div style="clear:left"></div>
<div class="paragraph"><p><tt>__sleep</tt> 魔术方法不能序列化基类的私有变量，<tt>Serializable</tt> 接口解决了这个问题。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;?php</span>

interface Serializable <span style="color: #FF0000">{</span>
    public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">serialize</span></span><span style="color: #990000">();</span>   <span style="font-style: italic"><span style="color: #9A1900">//需要返回序列后的字符串，通常调用serialize()得到.</span></span>
    public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">unserialize</span></span><span style="color: #990000">();</span> 
<span style="color: #FF0000">}</span></tt></pre></div></div>
<h3 id="_9_6_spl_123">1.6. 9.6 SPL自动加载 123</h3><div style="clear:left"></div>
<div class="paragraph"><p>在全局范围内简单的声明两个 <tt>__autoload()</tt> 会产生错误，<tt>spl_autoload_register()</tt> 解决了这个问题。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;?php</span>

<span style="font-weight: bold"><span style="color: #000000">spl_autoload_register</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">,</span><span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #000000">spl_autoload_extensions</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'.php,.inc,.class,.interface'</span><span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">myLoader1</span></span><span style="color: #990000">(</span><span style="color: #009900">$class</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  <span style="font-style: italic"><span style="color: #9A1900">//Do something to try to load the $class</span></span>
<span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">myLoader2</span></span><span style="color: #990000">(</span><span style="color: #009900">$class</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  <span style="font-style: italic"><span style="color: #9A1900">//Maybe load the class from another path</span></span>
<span style="color: #FF0000">}</span>
<span style="font-weight: bold"><span style="color: #000000">spl_autoload_register</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'myLoader1'</span><span style="color: #990000">,</span><span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #000000">spl_autoload_register</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'myLoader2'</span><span style="color: #990000">,</span><span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">);</span>
<span style="color: #009900">$test</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">SomeClass</span></span><span style="color: #990000">();</span>

<span style="color: #990000">---------------</span>保留__autoload<span style="color: #990000">-------------------</span>

<span style="font-weight: bold"><span style="color: #0000FF">if</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">false</span></span> <span style="color: #990000">===</span> <span style="font-weight: bold"><span style="color: #000000">spl_autoload_functions</span></span><span style="color: #990000">())</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">if</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">function_exists</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'__autoload'</span><span style="color: #990000">))</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #000000">spl_autoload_register</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'__autoload'</span><span style="color: #990000">,</span><span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">);</span>
  <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>
<span style="font-style: italic"><span style="color: #9A1900">//Continue to register autoload functions</span></span>

<span style="color: #990000">--------------------</span>安全加载类<span style="color: #990000">---------------</span>

<span style="font-style: italic"><span style="color: #9A1900">//Try to load className.php</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">if</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">spl_autoload_call</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'className'</span><span style="color: #990000">)</span>
  <span style="color: #990000">&amp;&amp;</span> <span style="font-weight: bold"><span style="color: #000000">class_exists</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'className'</span><span style="color: #990000">,</span><span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">)</span>
  <span style="color: #990000">)</span> <span style="color: #FF0000">{</span>

  <span style="font-weight: bold"><span style="color: #0000FF">echo</span></span> <span style="color: #FF0000">'className was loaded'</span><span style="color: #990000">;</span>

  <span style="font-style: italic"><span style="color: #9A1900">//Safe to instantiate className</span></span>
  <span style="color: #009900">$instance</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">className</span></span><span style="color: #990000">();</span>
<span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #FF0000">{</span>

  <span style="font-style: italic"><span style="color: #9A1900">//Not safe to instantiate className</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">echo</span></span> <span style="color: #FF0000">'className was not found'</span><span style="color: #990000">;</span>

<span style="color: #FF0000">}</span></tt></pre></div></div>
<h3 id="_9_7_126">1.7. 9.7 对象标识符 126</h3><div style="clear:left"></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;?php</span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> a <span style="color: #FF0000">{}</span>
<span style="color: #009900">$instance</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">a</span></span><span style="color: #990000">();</span>
<span style="color: #009900">$reference</span> <span style="color: #990000">=</span> <span style="color: #009900">$instance</span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">echo</span></span> <span style="font-weight: bold"><span style="color: #000000">spl_object_hash</span></span><span style="color: #990000">(</span><span style="color: #009900">$instance</span><span style="color: #990000">)</span> <span style="color: #990000">.</span> <span style="color: #FF0000">"\n"</span><span style="color: #990000">;</span>
<span style="font-weight: bold"><span style="color: #0000FF">echo</span></span> <span style="font-weight: bold"><span style="color: #000000">spl_object_hash</span></span><span style="color: #990000">(</span><span style="color: #009900">$reference</span><span style="color: #990000">)</span> <span style="color: #990000">.</span> <span style="color: #FF0000">"\n"</span><span style="color: #990000">;</span>

<span style="font-style: italic"><span style="color: #9A1900">//会返回相同的值，因为后者只是对象的引用（物理储存还是一样）。而每个对象都有一个唯一的标识符。</span></span>

php <span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> a<span style="color: #FF0000">{}</span><span style="color: #990000">;</span>
php <span style="color: #990000">&gt;</span> <span style="color: #009900">$ca</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">a</span></span><span style="color: #990000">();</span>
php <span style="color: #990000">&gt;</span> <span style="color: #009900">$cb</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">a</span></span><span style="color: #990000">();</span>
php <span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #000000">spl_object_hash</span></span><span style="color: #990000">(</span><span style="color: #009900">$ca</span><span style="color: #990000">);</span>
php <span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #0000FF">echo</span></span> <span style="font-weight: bold"><span style="color: #000000">spl_object_hash</span></span><span style="color: #990000">(</span><span style="color: #009900">$ca</span><span style="color: #990000">);</span>
33595103288c97645c4f9cf3e782477f
php <span style="color: #990000">&gt;</span> <span style="font-weight: bold"><span style="color: #0000FF">echo</span></span> <span style="font-weight: bold"><span style="color: #000000">spl_object_hash</span></span><span style="color: #990000">(</span><span style="color: #009900">$cb</span><span style="color: #990000">);</span>
0af5f6846f3c7973fc3d15b858d658b6

<span style="font-style: italic"><span style="color: #9A1900">//即使是同一个类的实例，应该不是一个对象（物理储存位置不同），标识符也不相同。</span></span></tt></pre></div></div>
</div>
<h2 id="_10_spl_128">2. 第10章 SPL迭代器 128</h2>
<div class="sectionbody">
<h3 id="_10_1_128">2.1. 10.1 迭代器接口和迭代器 128</h3><div style="clear:left"></div>
<h4 id="_10_1_1_128">2.1.1. 10.1.1 迭代器接口 128</h4>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Traversable,  只有内部的类（C编写的)才能直接实现该接口
</p>
</li>
<li>
<p>
Iterator
</p>
</li>
<li>
<p>
IteratorAggregate, 可以在类的外部实现迭代功能，即可复用它。可和ArrayIterator配合使用
</p>
</li>
<li>
<p>
OuterIterator, 将多个迭代器包裹成一个大的迭代器。
</p>
</li>
<li>
<p>
RecursiveIterator, 提供了递归迭代访问功能，可用来表达一个树形的数据结构，例如目录。
</p>
</li>
</ol></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;?php</span>

interface IteratorAggregate <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> Traverable <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">getIterator</span></span><span style="color: #990000">();</span> <span style="font-style: italic"><span style="color: #9A1900">//必须返回一个实现了Iterator接口的类的实例。</span></span>
<span style="color: #FF0000">}</span>

interface OuterInterator <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> Iterator <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">getInnerIterator</span></span><span style="color: #990000">();</span>
<span style="color: #FF0000">}</span>

interface RecursiveIterator <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> Iterator <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">hasChildren</span></span><span style="color: #990000">();</span>
    <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">getChildren</span></span><span style="color: #990000">();</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<h4 id="_10_1_2_130">2.1.2. 10.1.2 迭代器 130</h4>
<div class="paragraph"><div class="title">ArrayIterator</div><p>从数组创建一个迭代器。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;?php</span>

<span style="color: #009900">$arr</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">array</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'a'</span><span style="color: #990000">,</span><span style="color: #FF0000">'b'</span><span style="color: #990000">,</span><span style="color: #FF0000">'c'</span><span style="color: #990000">);</span>
<span style="color: #009900">$iterator</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ArrayIterator</span></span><span style="color: #990000">(</span><span style="color: #009900">$arr</span><span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">foreach</span></span><span style="color: #990000">(</span><span style="color: #009900">$iterator</span> <span style="font-weight: bold"><span style="color: #0000FF">as</span></span> <span style="color: #009900">$val</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">echo</span></span> <span style="color: #009900">$val</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>它是基础，其他迭代器都只接受Iterator类型为参数，而不是直接接受Array类型.</p></div>
<div class="paragraph"><div class="title">LimitIterator</div><p><tt>new LimitIterator( Iterator $iterator [, string $offset [, string $count ]] )</tt>
接受参数：迭代器，偏移量，限制数量
可用于处理数据集的分页显示。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;?php</span>

<span style="color: #009900">$arr</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">array</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span><span style="color: #993399">2</span><span style="color: #990000">,</span><span style="color: #993399">3</span><span style="color: #990000">,</span><span style="color: #993399">4</span><span style="color: #990000">,</span><span style="color: #993399">5</span><span style="color: #990000">,</span><span style="color: #993399">6</span><span style="color: #990000">,</span><span style="color: #993399">7</span><span style="color: #990000">,</span><span style="color: #993399">8</span><span style="color: #990000">,</span><span style="color: #993399">9</span><span style="color: #990000">);</span>
<span style="color: #009900">$arrIterator</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ArrayIterator</span></span><span style="color: #990000">(</span><span style="color: #009900">$arr</span><span style="color: #990000">);</span>
<span style="color: #009900">$limitIterator</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">LimitIterator</span></span><span style="color: #990000">(</span><span style="color: #009900">$arrIterator</span><span style="color: #990000">,</span> <span style="color: #993399">3</span><span style="color: #990000">,</span> <span style="color: #993399">4</span><span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #0000FF">foreach</span></span><span style="color: #990000">(</span><span style="color: #009900">$limitIterator</span> <span style="font-weight: bold"><span style="color: #0000FF">as</span></span> <span style="color: #009900">$number</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">echo</span></span> <span style="color: #009900">$number</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
AppendIterator
组合多个迭代器，一起循环。

<span style="color: #009900">$arrFirst</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ArrayIterator</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">array</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span><span style="color: #993399">2</span><span style="color: #990000">,</span><span style="color: #993399">3</span><span style="color: #990000">));</span>
<span style="color: #009900">$arrSecond</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ArrayIterator</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">array</span></span><span style="color: #990000">(</span><span style="color: #993399">4</span><span style="color: #990000">,</span><span style="color: #993399">5</span><span style="color: #990000">,</span><span style="color: #993399">6</span><span style="color: #990000">));</span>

<span style="color: #009900">$iterator</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">AppendIterator</span></span><span style="color: #990000">();</span>
<span style="color: #009900">$iterator</span><span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">append</span></span><span style="color: #990000">(</span><span style="color: #009900">$arrFirst</span><span style="color: #990000">);</span>
<span style="color: #009900">$iterator</span><span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">append</span></span><span style="color: #990000">(</span><span style="color: #009900">$arrSecond</span><span style="color: #990000">);</span>

<span style="font-weight: bold"><span style="color: #0000FF">foreach</span></span><span style="color: #990000">(</span><span style="color: #009900">$iterator</span> <span style="font-weight: bold"><span style="color: #0000FF">as</span></span> <span style="color: #009900">$number</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">echo</span></span> <span style="color: #009900">$number</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><div class="title">FilterIterator</div><p>是个抽象类，基于 <tt>OuterIterator</tt> 接口，用来过滤数据，返回符合条件的元素。</p></div>
<div class="paragraph"><p>例如和 <tt>DirecoryIterator</tt> 类一起返回一个大文件列表。
抽象方法 <tt>accept()</tt> 必须返回boolean,为true，接受，为false，排除。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;?php</span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> GreaterThanThreeFilterIterator <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> FilterIterator <span style="color: #FF0000">{</span>
  public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">accept</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">(</span><span style="color: #009900">$this</span><span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">current</span></span><span style="color: #990000">()</span> <span style="color: #990000">&gt;</span> <span style="color: #993399">3</span><span style="color: #990000">);</span>  <span style="font-style: italic"><span style="color: #9A1900">// T/F</span></span>
  <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>
<span style="color: #009900">$arr</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ArrayIterator</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">array</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span><span style="color: #993399">2</span><span style="color: #990000">,</span><span style="color: #993399">3</span><span style="color: #990000">,</span><span style="color: #993399">4</span><span style="color: #990000">,</span><span style="color: #993399">5</span><span style="color: #990000">,</span><span style="color: #993399">6</span><span style="color: #990000">));</span>

<span style="color: #009900">$iterator</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">GreaterThanThreeFilterIterator</span></span><span style="color: #990000">(</span><span style="color: #009900">$arr</span><span style="color: #990000">);</span>
<span style="font-weight: bold"><span style="color: #000000">print_r</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">iterator_to_array</span></span><span style="color: #990000">(</span><span style="color: #009900">$iterator</span><span style="color: #990000">));</span></tt></pre></div></div>
<div class="paragraph"><div class="title">RegexIterator</div><p>继承于 <tt>FilterIterator</tt> ，可使用正则表达式。</p></div>
<div class="paragraph"><p><tt>$iterator = new RegexIterator($arrIterator, "/^a/");</tt></p></div>
<div class="paragraph"><div class="title">IteratorIterator</div><p>有些PHP扩展并没实现 <tt>Iterator</tt> 接口，而是实现了更底层的 <tt>Traversable</tt> 。例如 <tt>PDO</tt> .故如果要使用更高级的迭代器，就必须用该通用接口来做一个中转。</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;?php</span>

<span style="color: #009900">$db</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">PDO</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'pgsql:dbname=yourdb;user=youruser'</span><span style="color: #990000">);</span>
<span style="color: #009900">$pdoStatement</span> <span style="color: #990000">=</span> <span style="color: #009900">$db</span><span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">query</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'SELECT * FROM table'</span><span style="color: #990000">);</span>

<span style="color: #009900">$iterator</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">IteratorIterator</span></span><span style="color: #990000">(</span><span style="color: #009900">$pdoStatement</span><span style="color: #990000">);</span>
<span style="color: #009900">$limitIterator</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">LimitIterator</span></span><span style="color: #990000">(</span><span style="color: #009900">$iterator</span><span style="color: #990000">,</span> <span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #993399">10</span><span style="color: #990000">);</span>
<span style="color: #009900">$tenRecordArray</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">iterator_to_array</span></span><span style="color: #990000">(</span><span style="color: #009900">$limitIterator</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><div class="title">CachingIterator</div><p>提前读取下一个元素</p></div>
<div class="paragraph"><div class="title">SeekableIterator</div><p>非顺序访问，可跳到任何一个点上。</p></div>
<div class="paragraph"><div class="title">NORewindIterator</div><p>不能回卷。</p></div>
<div class="paragraph"><div class="title">EmptyIterator</div><p>占位符</p></div>
<div class="paragraph"><div class="title">InfiniteIterator</div><p>自动回卷</p></div>
<div class="paragraph"><div class="title">RecursiveArrayIterator</div><p>创建一个用于递归形式数据结构的迭代器</p></div>
<div class="paragraph"><div class="title">RecursiveIteratorIterator</div><p>允许获得一个树形结构，并将其展开为一个一维结构。
<tt>__construct ( Traversable $iterator [, int $mode = LEAVES_ONLY [, int $flags = 0 ]] )</tt></p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;?php</span>

<span style="color: #009900">$arr</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">array</span></span><span style="color: #990000">(</span>
         <span style="color: #993399">0</span> <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">'a'</span><span style="color: #990000">;</span>
         <span style="color: #993399">1</span> <span style="color: #990000">=&gt;</span> <span style="font-weight: bold"><span style="color: #0000FF">array</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'a'</span><span style="color: #990000">,</span><span style="color: #FF0000">'b'</span><span style="color: #990000">,</span><span style="color: #FF0000">'c'</span><span style="color: #990000">),</span>
         <span style="color: #993399">2</span> <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">'b'</span><span style="color: #990000">,</span>
         <span style="color: #993399">3</span> <span style="color: #990000">=&gt;</span> <span style="font-weight: bold"><span style="color: #0000FF">array</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'a'</span><span style="color: #990000">,</span><span style="color: #FF0000">'b'</span><span style="color: #990000">,</span><span style="color: #FF0000">'c'</span><span style="color: #990000">),</span>
         <span style="color: #993399">4</span> <span style="color: #990000">=&gt;</span> <span style="color: #FF0000">'c'</span>
<span style="color: #990000">);</span>

<span style="color: #009900">$arrayIterator</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">RecursiveArrayIterator</span></span><span style="color: #990000">(</span><span style="color: #009900">$arr</span><span style="color: #990000">);</span>

<span style="color: #009900">$it</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">RecursiveIteratorIterator</span></span><span style="color: #990000">(</span><span style="color: #009900">$arrayIterator</span><span style="color: #990000">);</span>

<span style="font-weight: bold"><span style="color: #000000">print_r</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">iterator_to_array</span></span><span style="color: #990000">(</span><span style="color: #009900">$it</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">));</span>

<span style="font-style: italic"><span style="color: #9A1900">/* 输出结果</span></span>
<span style="font-style: italic"><span style="color: #9A1900">Array {</span></span>
<span style="font-style: italic"><span style="color: #9A1900">[0] =&gt; a</span></span>
<span style="font-style: italic"><span style="color: #9A1900">[1] =&gt; a</span></span>
<span style="font-style: italic"><span style="color: #9A1900">[2] =&gt; b</span></span>
<span style="font-style: italic"><span style="color: #9A1900">[3] =&gt; c</span></span>
<span style="font-style: italic"><span style="color: #9A1900">[4] =&gt; b</span></span>
<span style="font-style: italic"><span style="color: #9A1900">[5] =&gt; a</span></span>
<span style="font-style: italic"><span style="color: #9A1900">[6] =&gt; b</span></span>
<span style="font-style: italic"><span style="color: #9A1900">[7] =&gt; c</span></span>
<span style="font-style: italic"><span style="color: #9A1900">[8] =&gt; c</span></span>
<span style="font-style: italic"><span style="color: #9A1900">}</span></span>
<span style="font-style: italic"><span style="color: #9A1900">*/</span></span></tt></pre></div></div>
<div class="paragraph"><div class="title">RecursiveTreeIterator</div><p>非内置，是example目录中的一个示范。
返回树形式，类似tree命令得到的结果。</p></div>
<div class="paragraph"><div class="title">ParentIterator</div><p>扩展于FilterIterator，只返回包含子元素的</p></div>
<div class="paragraph"><div class="title">RecursiveFilterIterator</div><p>递归版的FilterIterator。</p></div>
<div class="paragraph"><div class="title">SearchIterator</div><p>和 <tt>FilterIterator</tt> 一样是个抽象类，抽象方法也为 <tt>accept</tt> ，但找到一个匹配后便会停止操作。</p></div>
<div class="paragraph"><div class="title">iterator_to_array</div><p><tt>array iterator_to_array ( Traversable $iterator [, bool $use_keys = true ] )</tt></p></div>
<div class="paragraph"><p>当 <tt>$use_keys = fasle</tt> 时，出现重复 <tt>key</tt> 时，不会互相覆盖。</p></div>
<h3 id="_10_2_142">2.2. 10.2 迭代器的实际用法 142</h3><div style="clear:left"></div>
<h4 id="_10_2_1_simplexml_xml_142">2.2.1. 10.2.1 使用SimpleXML解析XML文件.. 142</h4>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;library&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;book&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;name&gt;</span></span>Pro PHP<span style="font-weight: bold"><span style="color: #0000FF">&lt;/name&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;author&gt;</span></span>Kevin McArthur<span style="font-weight: bold"><span style="color: #0000FF">&lt;/author&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/book&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;book&gt;</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">&lt;name&gt;</span></span>Other Book<span style="font-weight: bold"><span style="color: #0000FF">&lt;/name&gt;</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">&lt;/book&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/library&gt;</span></span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;?php</span>

<span style="color: #009900">$it</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">SimpleXMLIterator</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">file_get_contents</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'test.xml'</span><span style="color: #990000">));</span>

<span style="font-weight: bold"><span style="color: #0000FF">foreach</span></span><span style="color: #990000">(</span><span style="color: #009900">$it</span> <span style="font-weight: bold"><span style="color: #0000FF">as</span></span> <span style="color: #009900">$key</span><span style="color: #990000">=&gt;</span><span style="color: #009900">$node</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">echo</span></span> <span style="color: #009900">$key</span> <span style="color: #990000">.</span> <span style="color: #FF0000">"\n"</span><span style="color: #990000">;</span>
  <span style="font-weight: bold"><span style="color: #0000FF">if</span></span><span style="color: #990000">(</span><span style="color: #009900">$it</span><span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">hasChildren</span></span><span style="color: #990000">())</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">foreach</span></span><span style="color: #990000">(</span><span style="color: #009900">$it</span><span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getChildren</span></span><span style="color: #990000">()</span> <span style="font-weight: bold"><span style="color: #0000FF">as</span></span> <span style="color: #009900">$element</span><span style="color: #990000">=&gt;</span><span style="color: #009900">$value</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
      <span style="font-weight: bold"><span style="color: #0000FF">echo</span></span> <span style="color: #FF0000">"\t"</span><span style="color: #990000">.</span> <span style="color: #009900">$element</span> <span style="color: #990000">.</span> <span style="color: #FF0000">":"</span> <span style="color: #990000">.</span> <span style="color: #009900">$value</span> <span style="color: #990000">.</span><span style="color: #FF0000">"\n"</span><span style="color: #990000">;</span>
    <span style="color: #FF0000">}</span>
  <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span>

<span style="font-style: italic"><span style="color: #9A1900">/* 输出:</span></span>
<span style="font-style: italic"><span style="color: #9A1900">book</span></span>
<span style="font-style: italic"><span style="color: #9A1900">    name:Pro PHP</span></span>
<span style="font-style: italic"><span style="color: #9A1900">    author:Kevin McArthur</span></span>
<span style="font-style: italic"><span style="color: #9A1900">book</span></span>
<span style="font-style: italic"><span style="color: #9A1900">    name:Other Book</span></span>
<span style="font-style: italic"><span style="color: #9A1900">*/</span></span></tt></pre></div></div>
<h4 id="_10_2_2_dba_143">2.2.2. 10.2.2 使用DBA访问平面文件数据库 143</h4>
<div class="paragraph"><p>解析文件（例如.ini)</p></div>
</div>
<h2 id="_11_spl_145">3. 第11章 SPL文件和目录处理 145</h2>
<div class="sectionbody">
<h3 id="_11_1_145">3.1. 11.1 文件和目录信息 145</h3><div style="clear:left"></div>
<div class="paragraph"><div class="title">SplFileInfo </div><p><tt>__construct ( string $file_name )</tt>
返回对象方式文件详情，
其中path等于dirname()一样，而pathname只是输入参数$file_name的副本。
后面将要讲到的关于文件和目录处理的迭代器基本都是返回一个SplFileInfo对象。</p></div>
<h3 id="_11_2_147">3.2. 11.2 目录的迭代访问 147</h3><div style="clear:left"></div>
<h4 id="_11_2_1_148">3.2.1. 11.2.1 列出文件和目录的清单 148</h4>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;?php</span>

DirectoryIterator <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> SplFileInfo implements Iterator <span style="color: #990000">,</span> Traversable <span style="color: #990000">,</span> SeekableIterator <span style="color: #FF0000">{</span>
<span style="font-style: italic"><span style="color: #9A1900">/* Methods */</span></span>
<span style="font-weight: bold"><span style="color: #000000">__construct</span></span> <span style="color: #990000">(</span> string <span style="color: #009900">$path</span> <span style="color: #990000">)</span>
<span style="font-style: italic"><span style="color: #9A1900">//DirectoryIterator::isDot — Determine if current DirectoryIterator item is '.' or '..'</span></span>
public bool <span style="font-weight: bold"><span style="color: #000000">isDot</span></span> <span style="color: #990000">(</span> void <span style="color: #990000">)</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;?php</span>

<span style="color: #009900">$pathName</span> <span style="color: #990000">=</span> <span style="color: #FF0000">'/path/to/iterate/'</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #0000FF">foreach</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">DirectoryIterator</span></span><span style="color: #990000">(</span><span style="color: #009900">$pathName</span><span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">as</span></span> <span style="color: #009900">$fileInfo</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">echo</span></span> <span style="color: #009900">$fileInfo</span> <span style="color: #990000">.</span> <span style="color: #FF0000">"\n"</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="paragraph"><p>递归版 <tt>RecursiveDirectoryIterator</tt>.</p></div>
<h4 id="_11_2_2_150">3.2.2. 11.2.2 查找文件 150</h4>
<div class="paragraph"><div class="title"><tt>FindFile</tt></div><p><tt>__construct( string $path, string $file_name )</tt></p></div>
<div class="paragraph"><div class="title">RegexFindFile</div><p>直接正则表达式的FindFile.</p></div>
<h4 id="_11_2_3_151">3.2.3. 11.2.3 创建自定义文件过滤迭代器 151</h4>
<div class="listingblock">
<div class="title">创建从FilterIterator迭代器继承的类并实现accept()即可。</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;?php</span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> FileExtensionFinder <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> FilterIterator <span style="color: #FF0000">{</span>

  protected <span style="color: #009900">$predicate</span><span style="color: #990000">,</span> <span style="color: #009900">$path</span><span style="color: #990000">;</span>

  public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">__construct</span></span><span style="color: #990000">(</span><span style="color: #009900">$path</span><span style="color: #990000">,</span> <span style="color: #009900">$predicate</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">$this</span><span style="color: #990000">-&gt;</span>predicate <span style="color: #990000">=</span> <span style="color: #009900">$predicate</span><span style="color: #990000">;</span>
    <span style="color: #009900">$this</span><span style="color: #990000">-&gt;</span>path <span style="color: #990000">=</span> <span style="color: #009900">$path</span><span style="color: #990000">;</span>

    <span style="color: #009900">$it</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">RecursiveDirectoryIterator</span></span><span style="color: #990000">(</span><span style="color: #009900">$path</span><span style="color: #990000">);</span> <span style="font-style: italic"><span style="color: #9A1900">//将目录转化为目录迭代器</span></span>
    <span style="color: #009900">$flatIterator</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">RecursiveIteratorIterator</span></span><span style="color: #990000">(</span><span style="color: #009900">$it</span><span style="color: #990000">);</span> <span style="font-style: italic"><span style="color: #9A1900">//将迭代器展开为一维</span></span>

    parent<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">__construct</span></span><span style="color: #990000">(</span><span style="color: #009900">$flatIterator</span><span style="color: #990000">);</span>

  <span style="color: #FF0000">}</span>

  public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">accept</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">$pathInfo</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">pathinfo</span></span><span style="color: #990000">(</span><span style="color: #009900">$this</span><span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">current</span></span><span style="color: #990000">());</span>
    <span style="color: #009900">$extension</span> <span style="color: #990000">=</span> <span style="color: #009900">$pathInfo</span><span style="color: #990000">[</span><span style="color: #FF0000">'extension'</span><span style="color: #990000">];</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">(</span><span style="color: #009900">$extension</span> <span style="color: #990000">==</span> <span style="color: #009900">$this</span><span style="color: #990000">-&gt;</span>predicate<span style="color: #990000">);</span>
  <span style="color: #FF0000">}</span>

<span style="color: #FF0000">}</span>

<span style="color: #009900">$it</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">FileExtensionFinder</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'/path/to/search/'</span><span style="color: #990000">,</span><span style="color: #FF0000">'php'</span><span style="color: #990000">);</span>

<span style="font-weight: bold"><span style="color: #0000FF">foreach</span></span><span style="color: #990000">(</span><span style="color: #009900">$it</span> <span style="font-weight: bold"><span style="color: #0000FF">as</span></span> <span style="color: #009900">$entry</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">echo</span></span> <span style="color: #009900">$entry</span> <span style="color: #990000">.</span> <span style="color: #FF0000">"\n"</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<h3 id="_11_3_spl_153">3.3. 11.3 SPL文件对象操作 153</h3><div style="clear:left"></div>
<div class="paragraph"><p>SplFileObject类将PHP文件中的I/O函数综合在一起，如fopen,fread等，形成一个多功能的面向对象的接口。
它也是一个迭代器。</p></div>
<h3 id="_11_3_1_153">3.4. 11.3.1 文件内容的迭代访问 153</h3><div style="clear:left"></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;?php</span>

<span style="color: #009900">$it</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">SplFileObject</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'pm.csv'</span><span style="color: #990000">);</span>

<span style="font-weight: bold"><span style="color: #0000FF">foreach</span></span><span style="color: #990000">(</span><span style="color: #009900">$it</span> <span style="font-weight: bold"><span style="color: #0000FF">as</span></span> <span style="color: #009900">$line</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">echo</span></span> <span style="color: #009900">$line</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>
<span style="color: #993399">11.3</span><span style="color: #990000">.</span><span style="color: #993399">2</span> CSV操作 <span style="color: #993399">153</span>
<span style="color: #009900">$it</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">SplFileObject</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'pm.csv'</span><span style="color: #990000">);</span>

<span style="font-weight: bold"><span style="color: #0000FF">while</span></span><span style="color: #990000">(</span><span style="color: #009900">$array</span> <span style="color: #990000">=</span> <span style="color: #009900">$it</span><span style="color: #990000">-&gt;</span><span style="font-weight: bold"><span style="color: #000000">fgetcsv</span></span><span style="color: #990000">())</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #000000">var_export</span></span><span style="color: #990000">(</span><span style="color: #009900">$array</span><span style="color: #990000">);</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>自定义CSV解析迭代器 详见笔记附录</p></div>
<h4 id="_11_3_3_157">3.4.1. 11.3.3 搜索文件 157</h4>
<div class="paragraph"><p>详见笔记附录</p></div>
</div>
<h2 id="_12_spl_160">4. 第12章 SPL数组重载 160</h2>
<div class="sectionbody">
<div class="paragraph"><p>数组重载是指将对象作为数组使用的过程，即索引器。</p></div>
<h3 id="_12_1_arrayaccess_160">4.1. 12.1 ArrayAccess接口介绍 160</h3><div style="clear:left"></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;?php</span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> MyArray implements ArrayAccess <span style="color: #FF0000">{</span>

  protected <span style="color: #009900">$_arr</span><span style="color: #990000">;</span>

  public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">__construct</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">$this</span><span style="color: #990000">-&gt;</span>_arr <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">array</span></span><span style="color: #990000">();</span>
  <span style="color: #FF0000">}</span>

  public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">offsetSet</span></span><span style="color: #990000">(</span><span style="color: #009900">$offset</span><span style="color: #990000">,</span> <span style="color: #009900">$value</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="color: #009900">$this</span><span style="color: #990000">-&gt;</span>_arr<span style="color: #990000">[</span><span style="color: #009900">$offset</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #009900">$value</span><span style="color: #990000">;</span>
  <span style="color: #FF0000">}</span>

  public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">offsetGet</span></span><span style="color: #990000">(</span><span style="color: #009900">$offset</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #009900">$this</span><span style="color: #990000">-&gt;</span>_arr<span style="color: #990000">[</span><span style="color: #009900">$offset</span><span style="color: #990000">];</span>
  <span style="color: #FF0000">}</span>

  public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">offsetExists</span></span><span style="color: #990000">(</span><span style="color: #009900">$offset</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">array_key_exists</span></span><span style="color: #990000">(</span><span style="color: #009900">$offset</span><span style="color: #990000">,</span> <span style="color: #009900">$this</span><span style="color: #990000">-&gt;</span>_arr<span style="color: #990000">);</span>
  <span style="color: #FF0000">}</span>

  public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">offsetUnset</span></span><span style="color: #990000">(</span><span style="color: #009900">$offset</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
    <span style="font-weight: bold"><span style="color: #0000FF">unset</span></span><span style="color: #990000">(</span><span style="color: #009900">$this</span><span style="color: #990000">-&gt;</span>_arr<span style="color: #990000">[</span><span style="color: #009900">$offset</span><span style="color: #990000">]);</span>
  <span style="color: #FF0000">}</span>

<span style="color: #FF0000">}</span>

<span style="color: #009900">$myArray</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">MyArray</span></span><span style="color: #990000">();</span>   <span style="font-style: italic"><span style="color: #9A1900">// Create an object as an array</span></span>
<span style="color: #009900">$myArray</span><span style="color: #990000">[</span><span style="color: #FF0000">'first'</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">'test'</span><span style="color: #990000">;</span> <span style="font-style: italic"><span style="color: #9A1900">// offsetSet, set data by key</span></span>
<span style="color: #009900">$demo</span> <span style="color: #990000">=</span> <span style="color: #009900">$myArray</span><span style="color: #990000">[</span><span style="color: #FF0000">'first'</span><span style="color: #990000">];</span>  <span style="font-style: italic"><span style="color: #9A1900">// offsetGet, get data by key</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">unset</span></span><span style="color: #990000">(</span><span style="color: #009900">$myArray</span><span style="color: #990000">[</span><span style="color: #FF0000">'first'</span><span style="color: #990000">]);</span>   <span style="font-style: italic"><span style="color: #9A1900">// offsetUnset, remove key</span></span></tt></pre></div></div>
<div class="paragraph"><p>ArrayAccess需要实现Countable接口才能实现count功能，该接口只需要实现count()方法即可。</p></div>
<h3 id="_12_2_arrayobject_161">4.2. 12.2 ArrayObject介绍 161</h3><div style="clear:left"></div>
<div class="paragraph"><p>ArrayObject类是一个ArrayAccess接口的实现类，它还提供了迭代功能，以及用来排序和处理数据的非常有用的方法。</p></div>
<div class="paragraph"><p><tt>__construct ($array, $flags=0, $iterator_class="ArrayIterator")</tt></p></div>
<div class="ulist"><div class="title">方法:</div><ul>
<li>
<p>
append ($value)
</p>
</li>
<li>
<p>
array[] = $value
</p>
</li>
<li>
<p>
asort ()
</p>
</li>
<li>
<p>
count ()
</p>
</li>
<li>
<p>
qxchangeArray ($array)  替换底层数组
</p>
</li>
<li>
<p>
getArrayCopy ()
</p>
</li>
<li>
<p>
getFlags ()
</p>
</li>
<li>
<p>
getIterator ()
</p>
</li>
<li>
<p>
getIteratorClass ()
</p>
</li>
<li>
<p>
ksort ()
</p>
</li>
<li>
<p>
natcasesort ()
</p>
</li>
<li>
<p>
natsort ()
</p>
</li>
<li>
<p>
offsetExists ($index)
</p>
</li>
<li>
<p>
offsetGet ($index)
</p>
</li>
<li>
<p>
offsetSet ($index, $newval)
</p>
</li>
<li>
<p>
offsetUnset ($index)
</p>
</li>
<li>
<p>
setFlags ($flags)
</p>
</li>
<li>
<p>
setIteratorClass ($itertor_class)
</p>
</li>
<li>
<p>
uasort (mixed cmp_function)
</p>
</li>
<li>
<p>
uksort (mixed cmp_function)
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;?php</span>


<span style="color: #009900">$myArray</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">ArrayObject</span></span><span style="color: #990000">();</span>
<span style="color: #009900">$myArray</span><span style="color: #990000">[</span><span style="color: #FF0000">'first'</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #FF0000">'test'</span><span style="color: #990000">;</span>

<span style="color: #009900">$demo</span> <span style="color: #990000">=</span> <span style="color: #009900">$myArray</span><span style="color: #990000">[</span><span style="color: #FF0000">'first'</span><span style="color: #990000">];</span>
<span style="font-weight: bold"><span style="color: #0000FF">unset</span></span><span style="color: #990000">(</span><span style="color: #009900">$myArray</span><span style="color: #990000">[</span><span style="color: #FF0000">'first'</span><span style="color: #990000">]);</span>

<span style="color: #009900">$numElements</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">count</span></span><span style="color: #990000">(</span><span style="color: #009900">$myArray</span><span style="color: #990000">);</span>
<span style="font-style: italic"><span style="color: #9A1900">//$numElements = $myArray-&gt;count();</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">foreach</span></span><span style="color: #990000">(</span><span style="color: #009900">$myArray</span> <span style="font-weight: bold"><span style="color: #0000FF">as</span></span> <span style="color: #009900">$key</span><span style="color: #990000">=&gt;</span><span style="color: #009900">$value</span><span style="color: #990000">)</span> <span style="color: #FF0000">{}</span></tt></pre></div></div>
<h3 id="_12_3_spl_162">4.3. 12.3 创建一个SPL购物车 162</h3><div style="clear:left"></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&lt;?php</span>

<span style="font-weight: bold"><span style="color: #000080">require_once</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'Product.php'</span><span style="color: #990000">);</span>

<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> Cart <span style="font-weight: bold"><span style="color: #0000FF">extends</span></span> ArrayObject <span style="color: #FF0000">{</span>

  protected <span style="color: #009900">$_products</span><span style="color: #990000">;</span>

  public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">__construct</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
        <span style="color: #009900">$this</span><span style="color: #990000">-&gt;</span>_products <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">array</span></span><span style="color: #990000">();</span>

        <span style="font-style: italic"><span style="color: #9A1900">/*</span></span>
<span style="font-style: italic"><span style="color: #9A1900">           Construct the underlying ArrayObject using</span></span>
<span style="font-style: italic"><span style="color: #9A1900">           $this-&gt;_products as the foundation array. This</span></span>
<span style="font-style: italic"><span style="color: #9A1900">           is important to ensure that the features</span></span>
<span style="font-style: italic"><span style="color: #9A1900">           of ArrayObject are available to your object.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">           用$_products这个作底层数组。</span></span>
<span style="font-style: italic"><span style="color: #9A1900">        */</span></span>
        parent<span style="color: #990000">::</span><span style="font-weight: bold"><span style="color: #000000">__construct</span></span><span style="color: #990000">(</span><span style="color: #009900">$this</span><span style="color: #990000">-&gt;</span>_products<span style="color: #990000">);</span>
  <span style="color: #FF0000">}</span>

public <span style="font-weight: bold"><span style="color: #0000FF">function</span></span> <span style="font-weight: bold"><span style="color: #000000">getCartTotal</span></span><span style="color: #990000">()</span> <span style="color: #FF0000">{</span>
  <span style="font-weight: bold"><span style="color: #0000FF">for</span></span><span style="color: #990000">(</span>
    <span style="color: #009900">$i</span><span style="color: #990000">=</span><span style="color: #009900">$sum</span><span style="color: #990000">=</span><span style="color: #993399">0</span><span style="color: #990000">,</span> <span style="color: #009900">$cnt</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">count</span></span><span style="color: #990000">(</span><span style="color: #009900">$this</span><span style="color: #990000">);</span> 
    <span style="color: #009900">$i</span><span style="color: #990000">&lt;</span><span style="color: #009900">$cnt</span><span style="color: #990000">;</span>
    <span style="color: #009900">$sum</span> <span style="color: #990000">+=</span> <span style="color: #009900">$this</span><span style="color: #990000">[</span><span style="color: #009900">$i</span><span style="color: #990000">++]-&gt;</span><span style="font-weight: bold"><span style="color: #000000">getPrice</span></span><span style="color: #990000">()</span>
  <span style="color: #990000">);</span>
  <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #009900">$sum</span><span style="color: #990000">;</span>
<span style="color: #FF0000">}</span>

<span style="color: #FF0000">}</span>

<span style="color: #009900">$cart</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Cart</span></span><span style="color: #990000">();</span>
<span style="color: #009900">$product</span> <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Product</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'00231-A'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'Description'</span><span style="color: #990000">,</span> <span style="color: #993399">1.99</span><span style="color: #990000">);</span>

<span style="color: #009900">$cart</span><span style="color: #990000">[]</span> <span style="color: #990000">=</span> <span style="color: #009900">$product</span><span style="color: #990000">;</span>

<span style="font-weight: bold"><span style="color: #000000">print_r</span></span><span style="color: #990000">(</span><span style="color: #009900">$cart</span><span style="color: #990000">);</span></tt></pre></div></div>
<h3 id="_12_4_165">4.4. 12.4 使用对象作为键值 165</h3><div style="clear:left"></div>
<div class="olist arabic"><div class="title">使用对象作为键值</div><ol class="arabic">
<li>
<p>
用实现了ArrayAccess接口的数组来做
</p>
</li>
<li>
<p>
使用spl_object_hash作为索引值来储存，$this&#8594;_keys[spl_object_hash($key)] = $key;
    $this&#8594;_values[spl_object_hash($key)] = $value;
</p>
</li>
<li>
<p>
extends ArrayIterator使之可以迭代访问
</p>
</li>
</ol></div>
<div class="paragraph"><p>代码详见笔记附录</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">笔记附录过长, 这里就不再继续贴出来了.</td>
</tr></table>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2011-04-06 01:10:11 CST
</div>
</div>
</body>
</html>
